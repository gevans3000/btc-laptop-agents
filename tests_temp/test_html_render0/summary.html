<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>Run Summary - test_run</title>
  <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
      line-height: 1.5;
      color: #1a1a1a;
      max-width: 1400px;
      margin: 0 auto;
      padding: 40px 20px;
      background-color: #f8f9fa;
    }
    h1, h2, h3 { color: #1a1a1a; font-weight: 700; margin-top: 0; }
    .section {
      background: white;
      border: 1px solid #e1e8ed;
      border-radius: 12px;
      padding: 24px;
      margin-bottom: 24px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.05);
    }
    .cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      gap: 14px;
      margin-bottom: 24px;
    }
    .card { background: #fdfdfd; border: 1px solid #eee; border-radius: 8px; padding: 16px; }
    .card-label {
      font-size: 11px;
      color: #666;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      font-weight: 600;
      margin-bottom: 4px;
    }
    .card-value { font-size: 20px; font-weight: 700; color: #111; }
    table {
      border-collapse: collapse;
      width: 100%;
      font-size: 13px;
      overflow: hidden;
      border-radius: 8px;
    }
    th, td { padding: 10px 12px; border-bottom: 1px solid #eee; }
    th {
      background: #f8f9fa;
      font-weight: 600;
      color: #495057;
      text-transform: uppercase;
      font-size: 11px;
      letter-spacing: 0.5px;
    }
    tr:last-child td { border-bottom: none; }
    tr:hover { background: #f8f9fa; }
    .text-left { text-align: left; }
    .text-right { text-align: right; }
    .text-center { text-align: center; }
    .text-muted { color: #868e96; font-size: 12px; }
    .badge {
      display: inline-block;
      padding: 3px 8px;
      border-radius: 4px;
      font-size: 10px;
      font-weight: 700;
      text-transform: uppercase;
    }
    .badge-long { background: #d3f9d8; color: #2b8a3e; }
    .badge-short { background: #ffe3e3; color: #c92a2a; }
    code {
      background: #f1f3f5;
      padding: 2px 6px;
      border-radius: 3px;
      font-size: 11px;
      font-family: 'Courier New', monospace;
    }
    .chart-container { height: 600px; width: 100%; }
    .status-badge {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
    }
    .status-live { background: #fff5f5; color: #e03131; border: 1px solid #ffc9c9; }
    .status-backtest { background: #f8f9fa; color: #495057; border: 1px solid #dee2e6; }
    pre { background: #1a1a1a; color: #f8f9fa; padding: 16px; border-radius: 8px; font-size: 12px; overflow-x: auto; }
  </style>
</head>
<body>
  <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 32px;">
    <div>
      <h1 style="margin-bottom: 4px;">Run Summary</h1>
      <div style="color: #666; font-size: 14px;">Run ID: test_run | None</div>
    </div>
    <div class="status-badge status-backtest">
      BACKTEST MODE
    </div>
  </div>

  

  <div class="section">
    <div class="cards">
      <div class="card"><div class="card-label">Symbol</div><div class="card-value">BTCUSDT</div></div>
      <div class="card"><div class="card-label">Interval</div><div class="card-value">1m</div></div>
      <div class="card"><div class="card-label">Source</div><div class="card-value">bitunix</div></div>
      <div class="card">
        <div class="card-label">Starting</div>
        <div class="card-value">$1000.00</div>
      </div>
      <div class="card">
        <div class="card-label">Ending</div>
        <div
          class="card-value"
          style="color: #2f9e44"
        >
          $1100.00
        </div>
      </div>
      <div class="card"><div class="card-label">Net PnL</div>
        <div class="card-value" style="color: #2f9e44">
          $100.00
        </div>
      </div>
    </div>

    <div id="main-chart" class="chart-container"></div>
  </div>

  <div class="section">
    <h2>Performance Curve</h2>
    <div style="height: 300px; width: 100%;">
      <canvas id="equityCanvas"></canvas>
    </div>
  </div>

  <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px;">
    
    
  </div>

  
  
  

  <div class="section">
    <h2>Last 10 Trades</h2>
    <table>
      <thead>
        <tr>
          <th class='text-left'>ID</th>
          <th class='text-center'>Side</th>
          <th class='text-right'>Entry</th>
          <th class='text-right'>Exit</th>
          <th class='text-right'>Qty</th>
          <th class='text-right'>PnL</th>
          <th class='text-right'>Fees</th>
          <th class='text-right'>Time</th>
        </tr>
      </thead>
      <tbody><tr><td colspan='8' class='text-center text-muted'>No trades executed</td></tr></tbody>
    </table>
  </div>

  <div class="section">
    <details>
      <summary style="cursor: pointer; font-weight: 600;">System Logs (Tail)</summary>
      <pre>{"event": "test"}</pre>
    </details>
  </div>

  <script>
    const candles = [];
    const trades = [];
    const equity = [];

    if (candles.length > 0) {
        const traceCandles = {
            x: candles.map(c => c.t),
            close: candles.map(c => c.c),
            high: candles.map(c => c.h),
            low: candles.map(c => c.l),
            open: candles.map(c => c.o),
            type: 'candlestick',
            name: 'Price',
            xaxis: 'x',
            yaxis: 'y'
        };

        const buyMarkers = {
            x: trades.filter(t => t.side === 'LONG').map(t => t.timestamp),
            y: trades.filter(t => t.side === 'LONG').map(t => t.entry),
            mode: 'markers',
            type: 'scatter',
            name: 'Buy',
            marker: { symbol: 'triangle-up', size: 12, color: '#2f9e44' },
            xaxis: 'x',
            yaxis: 'y'
        };

        const sellMarkers = {
            x: trades.filter(t => t.side === 'SHORT').map(t => t.timestamp),
            y: trades.filter(t => t.side === 'SHORT').map(t => t.entry),
            mode: 'markers',
            type: 'scatter',
            name: 'Sell',
            marker: { symbol: 'triangle-down', size: 12, color: '#e03131' },
            xaxis: 'x',
            yaxis: 'y'
        };

        const traceEquity = {
            x: equity.map(e => e.t),
            y: equity.map(e => e.v),
            type: 'scatter',
            name: 'Equity',
            line: { color: '#339af0', width: 2 },
            xaxis: 'x',
            yaxis: 'y2'
        };

        const layout = {
            dragmode: 'zoom',
            showlegend: true,
            margin: { t: 30, b: 30, l: 60, r: 60 },
            grid: { rows: 2, columns: 1, roworder: 'top to bottom' },
            xaxis: { rangeslider: { visible: false }, type: 'date' },
            yaxis: { title: 'Price', domain: [0.4, 1] },
            yaxis2: { title: 'Equity', domain: [0, 0.3], anchor: 'x' },
            paper_bgcolor: 'rgba(0,0,0,0)',
            plot_bgcolor: 'rgba(0,0,0,0)',
        };

        Plotly.newPlot('main-chart', [traceEquity], layout, { responsive: true });
    }

    // Chart.js Equity Chart Integration
    if (equity.length > 0) {
        const ctx = document.getElementById('equityCanvas').getContext('2d');
        new Chart(ctx, {
            type: 'line',
            data: {
                labels: equity.map(e => e.t),
                datasets: [{
                    label: 'Equity ($)',
                    data: equity.map(e => e.v),
                    borderColor: '#339af0',
                    backgroundColor: 'rgba(51, 154, 240, 0.1)',
                    borderWidth: 2,
                    fill: true,
                    tension: 0.1,
                    pointRadius: 0
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false }
                },
                scales: {
                    y: {
                        beginAtZero: false,
                        grid: { color: 'rgba(0,0,0,0.05)' }
                    },
                    x: {
                        display: false
                    }
                }
            }
        });
    }
  </script>
</body>
</html>
